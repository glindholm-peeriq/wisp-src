# Makefile to create new version of "runcbl", "acuconnect", or "acusql"
# based on changes to "sub.c"
#
# To relink the runtime, run: make runcbl
# To relink the AcuConnect server, run: make acuconnect
# To relink the ESQL pre-compiler, run: make acusql
#
# Distributed with ACUCOBOL-GT version 5.1.0.4
# PMK: 217

CC = cc
CFLAGS = -O $(ACUSERVER_FLAGS) $(ACUCONNECT_FLAGS) $(ACUSQL_FLAGS)
LDFLAGS = -s 

# If your ACUCOBOL libraries are in another directory, change the value
# of ACU_LIBDIR to point at them.
ACU_LIBDIR = .

#
# Socket configuration
#
SOCKET_LIBS = -lsocket

#
# AcuServer configuration
#

# Use the following two lines for an AcuServer-DISABLED runtime:
#ACUSERVER_FLAGS = -DNO_CLIENT=1
#ACUSERVER_LIBS = # nothing - no networking libraries are necessary

# Use the following two lines for an AcuServer-ENABLED runtime:
ACUSERVER_FLAGS =
ACUSERVER_LIBS = $(ACU_LIBDIR)/libclnt.a

#
# AcuConnect configuration
#

CONNECT_S = $(ACU_LIBDIR)/libconnects.a

# Use the following three lines for an AcuConnect-DISABLED runtime:
#ACUCONNECT_FLAGS = -DNO_ACUCONNECT=1
#CONNECT_C =

# Use the following three lines for an AcuConnect-ENABLED runtime:
ACUCONNECT_FLAGS = 
CONNECT_C = $(ACU_LIBDIR)/libconnectc.a

#
# AcuSQL configuration
#

# Enter the name of your CICS client library below if you want to relink an
# CICS-ENABLED runtime:
CICS_LIB_USE =

# Use the following two lines for an CICS-DISABLED runtime:
CICS_FLAGS = -DNO_CICS=1
CICS_LIB = # nothing - no cics libraries are necessary

# Use the following two lines for an CICS-ENABLED runtime:
#CICS_FLAGS = -DNO_CICS=0
#CICS_LIB = $(CICS_LIB_USE)

# Enter the name of your MQ Series client library below if you want to relink an
# MQSERIES-ENABLED runtime:
MQSERIES_LIB_USE =

# Use the following two lines for an MQSERIES-DISABLED runtime:
MQSERIES_FLAGS = -DNO_MQSERIES=1
MQSERIES_LIB = # nothing - no mqseries libraries are necessary

# Use the following two lines for an MQSERIES-ENABLED runtime:
#MQSERIES_FLAGS = -DNO_MQSERIES=0
#MQSERIES_LIB = $(MQSERIES_LIB_USE)

# Enter the name of your ODBC API library below if you want to relink an
# AcuSQL-ENABLED runtime or the AcuSQL precompiler:
ACUSQL_ODBC_LIB =

# Use the following two lines for an AcuSQL-DISABLED runtime:
ACUSQL_FLAGS = -DNO_ACUSQL=1
ACUSQL_LIBS = # nothing - no acusql runtime libraries are necessary

# Use the following two lines for an AcuSQL-ENABLED runtime:
#ACUSQL_FLAGS = -DNO_ACUSQL=0
#ACUSQL_LIBS = $(ACU_LIBDIR)/libesql.a $(ACUSQL_ODBC_LIB)

#
# File System Interface configuration
#

# These subs/libs are for any extra file systems you want to link in.
FSI_SUBS =
FSI_LIBS =


RUNLIB = $(ACU_LIBDIR)/libruncbl.a

LIBS =  $(ACUSERVER_LIBS) \
	$(ACU_LIBDIR)/libfsi.a \
	$(ACU_LIBDIR)/libacuterm.a \
	$(ACU_LIBDIR)/libvision.a \
	$(FSI_LIBS) \
	$(ACUSQL_LIBS) \
	$(CICS_LIB_USE) \
	$(MQSERIES_LIB_USE) \
	$(ACU_LIBDIR)/liblib.a \
	$(ACU_LIBDIR)/libcfg.a \
	$(ACU_LIBDIR)/libsocks.a \
	$(ACU_LIBDIR)/libmessage.a \
	$(ACU_LIBDIR)/libmemory.a \
	$(ACU_LIBDIR)/libstdlib.a \
	$(SOCKET_LIBS) -lm

SUBS = sub.o filetbl.o $(FSI_SUBS)

runcbl: $(SUBS)
	$(CC) $(LDFLAGS) -o runcbl $(SUBS) $(RUNLIB)  \
		$(CONNECT_C) $(LIBS) 

acuconnect: $(SUBS)
	$(CC) -c -DACUCONNECT_SRV sub.c
	$(CC) $(LDFLAGS) -o acuconnect $(SUBS) $(RUNLIB) \
		$(CONNECT_S) $(CONNECT_C) $(LIBS)

ALLOCA_LIBS = -lPW
ALLOCA_CFLAGS =

PREPROC_LIBS =	$(ACU_LIBDIR)/libpreproc.a \
		$(ACUSQL_ODBC_LIB) \
		$(ACU_LIBDIR)/libcfg.a \
		$(ACU_LIBDIR)/libmessage.a \
		$(ACU_LIBDIR)/libstdlib.a \
		$(ACU_LIBDIR)/libmemory.a

acusql: $(PREPROC_LIBS)
	$(CC) $(LDFLAGS) $(ALLOCA_CFLAGS) -o acusql $(PREPROC_LIBS) \
		$(ALLOCA_LIBS) -lm

sub.o: sub.c sub85.c config85.c direct.c Makefile

clean:
	-rm -f runcbl acuconnect acusql sub.o filetbl.o
